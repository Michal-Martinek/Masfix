
%define num 69
%macro cout() {
; NOTE outputs ordinals for each succesful (ctime) expansion
	mova 1
	outuh
	; no tokens should leak through end of macro expansion
}
%macro rstCou_n_t() {
	outc 10
	outc 83
	mov 0
}

; Unexpected tokens after macro use
%cout()
%cout()8
!cout()8
%cout() 8
!cout() 8
%cout()%
!cout()%
%cout() %
!cout() %
%cout()%num
!cout()%num
%cout() %num
!cout() %num

%cout(),
!cout(),
%cout() ,
!cout() ,
%cout()()
!cout()()
%cout() ()
!cout() ()

ld !rstCou_n_t()

; Unexpected macro use (situation before %)
%macro expInArglist(exp) {}
%expInArglist(%num)
%expInArglist(%cout())
%expInArglist(!cout())
%expInArglist( %cout())
%expInArglist( !cout())
%expInArglist(
	%cout())
%expInArglist(
	!cout())


%macro afterSep(a, b) { %b } ; if it complains then this mac was expanded
	%macro E() { & }
%afterSep(%num,%E())
%afterSep(%num,!cout())
%afterSep(%num, %E())
%afterSep(%num, !cout())
%afterSep(%num,
	%E())
%afterSep(%num,
	!cout())

ld !rstCou_n_t()

; inline after tokens
: %cout()
: !cout()
:l1 %cout()
:l2 !cout()
ld %cout()
ld !cout()
:l3 ld %cout()
:l4 ld !cout()

ld !rstCou_n_t()

,%cout()
,!cout()
, %cout()
, !cout()
()%cout()
()!cout()
() %cout()
() !cout()
(%cout())
(!cout())
( %cout())
( !cout())
(
	%cout())
(
	!cout())

; macro in arglist, but not first in it's field
%macro seeArglist1(a)    { see %a }
%macro seeArglist2(a, b) { see %b }

%seeArglist1(6 %cout())
%seeArglist1(7 !cout())
%seeArglist2(%cout(),7 %cout())
%seeArglist2(%cout(),8 !cout())
%seeArglist2(%cout(),8
				%cout())
%seeArglist2(%cout(),9
				!cout())

ld !rstCou_n_t()

; tokens after macro use
%seeArglist1(%cout() 3)
%seeArglist1(!cout() 4)
%seeArglist1(%cout()
					3)
%seeArglist1(!cout()
					4)
%seeArglist1((%cout() 5))
%seeArglist1((!cout() 5))

%cout() 6
!cout() 7
%cout(),
!cout(),

%macro inlineMacUse() { %cout() }
%macro inlineMacUse2(){ !cout() }
%inlineMacUse()
ld !inlineMacUse()
%inlineMacUse2()
ld !inlineMacUse2()
